# Architecture Comparison: Koku ClowdApp vs ROS Helm Chart

**Purpose**: Visual comparison of deployment architectures to understand the gaps and integration opportunities.

## Table of Contents
- [High-Level Architecture](#high-level-architecture)
- [API Layer Comparison](#api-layer-comparison)
- [Background Processing Comparison](#background-processing-comparison)
- [Data Flow Comparison](#data-flow-comparison)
- [Deployment Topology](#deployment-topology)
- [Integration Vision](#integration-vision)

---

## High-Level Architecture

### Current ROS Helm Chart Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Cost Mgmt        â”‚                 â”‚ OpenShift        â”‚    â”‚
â”‚  â”‚ Operator         â”‚                 â”‚ Console UI       â”‚    â”‚
â”‚  â”‚ (Upload Client)  â”‚                 â”‚ (API Client)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                      â”‚
            â”‚ JWT Token                            â”‚ OAuth2 Token
            â”‚                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      External Access Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Ingress Service  â”‚                 â”‚ ROS-OCP API      â”‚    â”‚
â”‚  â”‚ + Envoy (JWT)    â”‚                 â”‚ + Envoy (OAuth2) â”‚    â”‚
â”‚  â”‚ Port: 8080       â”‚                 â”‚ Port: 8000       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                      â”‚
            â”‚ File Upload                          â”‚ API Requests
            â”‚                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Processing Layer                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚           Single Unified API                        â”‚        â”‚
â”‚  â”‚     (Reads + Writes + Status)                      â”‚        â”‚
â”‚  â”‚              1 Pod                                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚               â”‚                        â”‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ROS-OCP Processor    â”‚  â”‚ Recommendation      â”‚           â”‚
â”‚  â”‚  (Kafka Consumer)     â”‚  â”‚ Poller              â”‚           â”‚
â”‚  â”‚  1 Pod                â”‚  â”‚ 1 Pod               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚PostgreSQLâ”‚  â”‚PostgreSQLâ”‚  â”‚ Redis    â”‚      â”‚
â”‚  â”‚  (ROS)   â”‚  â”‚ (Kruize) â”‚  â”‚ (Sources)â”‚  â”‚ (Cache)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Kafka (External) â”‚  â”‚ MinIO / ODF      â”‚                   â”‚
â”‚  â”‚ via Strimzi      â”‚  â”‚ (Object Storage) â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Kruize Autotune  â”‚  â”‚ Sources API      â”‚                   â”‚
â”‚  â”‚ (ML Engine)      â”‚  â”‚ (Middleware)     â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Pods: ~8-10
```

---

### Koku ClowdApp Architecture (Target)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Client Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Upload Service   â”‚  â”‚ Web UI           â”‚  â”‚ CLI Tools   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Layer (Separated)                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           API-READS (Read-Only Queries)               â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚   â”‚ Pod 1   â”‚  â”‚ Pod 2   â”‚  â”‚ Pod 3   â”‚  â”‚ Pod N   â”‚â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                 â”‚   Load Balanced â”‚                     â”‚    â”‚
â”‚  â”‚                 â–¼                                       â”‚    â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚    â”‚
â”‚  â”‚      â”‚  Read Replica DB    â”‚                           â”‚    â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           API-WRITES (Mutations & Updates)            â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚    â”‚
â”‚  â”‚   â”‚ Pod 1   â”‚  â”‚ Pod 2   â”‚                           â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜                                â”‚    â”‚
â”‚  â”‚                 â”‚                                      â”‚    â”‚
â”‚  â”‚                 â–¼                                      â”‚    â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚    â”‚
â”‚  â”‚      â”‚   Primary DB        â”‚                          â”‚    â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Tasks Published
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Background Processing Layer                   â”‚
â”‚                    (Celery Workers)                           â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Priority Processing (3 pools)                 â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  priority   â”‚ â”‚ priority-xl â”‚ â”‚priority-    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚   2 pods    â”‚ â”‚   2 pods    â”‚ â”‚ penalty     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  2 pods     â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Refresh Processing (3 pools)                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  refresh    â”‚ â”‚ refresh-xl  â”‚ â”‚ refresh-    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚   2 pods    â”‚ â”‚   2 pods    â”‚ â”‚ penalty     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  2 pods     â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Summary Processing (3 pools)                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  summary    â”‚ â”‚ summary-xl  â”‚ â”‚ summary-    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚   2 pods    â”‚ â”‚   2 pods    â”‚ â”‚ penalty     â”‚     â”‚  â”‚
â”‚  â”‚  â”‚             â”‚ â”‚             â”‚ â”‚  2 pods     â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Specialized Workers                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  download   â”‚ â”‚     hcs     â”‚ â”‚    subs-*   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚   2 pods    â”‚ â”‚   1 pod     â”‚ â”‚   0 pods    â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Task Scheduler                             â”‚  â”‚
â”‚  â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚  â”‚                â”‚ Celery Beat â”‚                          â”‚  â”‚
â”‚  â”‚                â”‚   1 pod     â”‚                          â”‚  â”‚
â”‚  â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Results & State
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Primary DB  â”‚  â”‚  Replica DB  â”‚  â”‚ Redis/       â”‚       â”‚
â”‚  â”‚  (Write)     â”‚â”€â”€â–¶â”‚  (Read)      â”‚  â”‚ RabbitMQ     â”‚       â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ (Broker)     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚    Kafka     â”‚  â”‚  S3/Minio    â”‚  â”‚ Prometheus   â”‚       â”‚
â”‚  â”‚ (Messages)   â”‚  â”‚ (Storage)    â”‚  â”‚ (Metrics)    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Pods: ~27+
```

---

## API Layer Comparison

### Current: Single Unified API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Client Requests                  â”‚
â”‚  (Reads + Writes + Status)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ All Traffic
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   rosocp-api Pod 1   â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ GET  /api/*    â”‚  â”‚
        â”‚  â”‚ POST /api/*    â”‚  â”‚
        â”‚  â”‚ PUT  /api/*    â”‚  â”‚
        â”‚  â”‚ DEL  /api/*    â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Primary Database  â”‚
        â”‚   (Read + Write)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Characteristics:
  âœ… Simple deployment
  âœ… Easy to understand
  âŒ Read/write contention
  âŒ Limited scaling
  âŒ All or nothing scaling
```

### Target: Separated Read/Write APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Client Requests                  â”‚
â”‚  (Reads + Writes + Status)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                      â”‚
           â”‚ Read Traffic         â”‚ Write Traffic
           â”‚ (90% of requests)    â”‚ (10% of requests)
           â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer      â”‚  â”‚  Load Balancer       â”‚
â”‚   (Read Pool)        â”‚  â”‚  (Write Pool)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”           â”‚
    â–¼      â–¼      â–¼      â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ Pod1 â”‚â”‚ Pod2 â”‚â”‚ Pod3 â”‚â”‚Pod N â”‚ â”‚ Pod1 â”‚
â”‚      â”‚â”‚      â”‚â”‚      â”‚â”‚      â”‚ â”‚      â”‚
â”‚ GET  â”‚â”‚ GET  â”‚â”‚ GET  â”‚â”‚ GET  â”‚ â”‚ POST â”‚
â”‚ only â”‚â”‚ only â”‚â”‚ only â”‚â”‚ only â”‚ â”‚ PUT  â”‚
â”‚      â”‚â”‚      â”‚â”‚      â”‚â”‚      â”‚ â”‚ DEL  â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”˜
    â”‚       â”‚       â”‚       â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
            â–¼       â–¼                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Read Replica   â”‚     â”‚  Primary DB     â”‚
     â”‚  Database       â”‚â—€â”€â”€â”€â”€â”‚  (Write)        â”‚
     â”‚  (Read-only)    â”‚     â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          Replication

Characteristics:
  âœ… Independent scaling
  âœ… 60-70% reduced primary DB load
  âœ… Better performance isolation
  âœ… Read-specific optimizations
  ğŸŸ¡ Slightly more complex
```

---

## Background Processing Comparison

### Current: Single Processor

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Kafka Topic        â”‚
â”‚  hccm.ros.events     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ All Messages
           â”‚ (FIFO order)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rosocp-processor    â”‚
â”‚     (1 Pod)          â”‚
â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Process Event  â”‚  â”‚
â”‚  â”‚ Wait for       â”‚  â”‚
â”‚  â”‚ Kruize (120s)  â”‚  â”‚
â”‚  â”‚ Next Event     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Throughput: ~30 events/minute
Bottleneck: Sequential processing
Priority: No priority support
Scaling: Limited
```

### Target: Specialized Worker Pools

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Message Broker (Redis)                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚priority  â”‚ â”‚ refresh  â”‚ â”‚ summary  â”‚ â”‚ default  â”‚    â”‚
â”‚   â”‚ queue    â”‚ â”‚ queue    â”‚ â”‚ queue    â”‚ â”‚ queue    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚            â”‚
         â”‚ Urgent     â”‚ Regular    â”‚ Heavy      â”‚ Low
         â”‚ Tasks      â”‚ Tasks      â”‚ Tasks      â”‚ Priority
         â”‚            â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Priority  â”‚ â”‚ Refresh  â”‚ â”‚ Summary  â”‚ â”‚ Default  â”‚
    â”‚ Workers  â”‚ â”‚ Workers  â”‚ â”‚ Workers  â”‚ â”‚ Workers  â”‚
    â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚ â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚ â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚ â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚
    â”‚â”‚P1â”‚ â”‚P2â”‚â”‚ â”‚â”‚R1â”‚ â”‚R2â”‚â”‚ â”‚â”‚S1â”‚ â”‚S2â”‚â”‚ â”‚â”‚D1â”‚ â”‚D2â”‚â”‚
    â”‚â””â”€â”€â”˜ â””â”€â”€â”˜â”‚ â”‚â””â”€â”€â”˜ â””â”€â”€â”˜â”‚ â”‚â””â”€â”€â”˜ â””â”€â”€â”˜â”‚ â”‚â””â”€â”€â”˜ â””â”€â”€â”˜â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚            â”‚            â”‚            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Task Results  â”‚
            â”‚   Stored in DB  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Throughput: 1000+ tasks/minute
Bottleneck: Eliminated via parallelization
Priority: Multi-level support
Scaling: Independent per queue
```

---

## Data Flow Comparison

### Current Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cost Mgmt       â”‚
â”‚ Operator        â”‚
â”‚ (Upload Client) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Upload Cost Data (CSV + manifest.json)
         â”‚    Authorization: Bearer <JWT_TOKEN>
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ingress Service â”‚
â”‚ + Envoy (JWT)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 2. Validate JWT
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    Extract org_id
         â”‚                   â”‚
         â”‚ 3. Store in       â”‚
         â”‚    MinIO/ODF      â”‚
         â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Object Storage  â”‚          â”‚
â”‚ (ros-data)      â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â”‚
         â”‚                   â”‚
         â”‚ 4. Publish event  â”‚
         â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Kafka Topic              â”‚
â”‚   hccm.ros.events           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 5. Consume event
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ROS-OCP         â”‚
â”‚ Processor       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 6. Download CSV
â”‚                 â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â”‚
         â”‚ 7. Parse CSV      â”‚
         â”‚    Extract metricsâ”‚
         â”‚                   â–¼
         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚   MinIO/ODF â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 8. Create Kruize Experiment
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Kruize      â”‚
â”‚   (ML Engine)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 9. Store experiment
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kruize DB      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 10. ML recommendations
         â”‚     (async, 15 min bucket)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Recommendation  â”‚
â”‚ Poller          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 11. Query recommendations
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
         â”‚                   â–¼
         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚  Kruize API â”‚
         â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 12. Store recommendations
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ROS DB       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps: 12
Latency: ~3-5 minutes
Parallelization: Limited
```

### Target Data Flow (with Workers)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cost Mgmt       â”‚
â”‚ Operator        â”‚
â”‚ (Upload Client) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 1. Upload Cost Data
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ingress + Auth  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 2. Store + Publish
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Kafka Topic              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ 3. Route to appropriate queue
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Message Broker (Redis)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Priority â”‚ â”‚ Refresh  â”‚ â”‚ Summary  â”‚            â”‚
â”‚  â”‚ (urgent) â”‚ â”‚ (normal) â”‚ â”‚ (heavy)  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚
        â”‚ Parallel Processing (All queues active)
        â”‚            â”‚            â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Workers  â”‚ â”‚ Workers  â”‚ â”‚ Workers  â”‚
   â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚ â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚ â”‚â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚
   â”‚â”‚W1â”‚ â”‚W2â”‚â”‚ â”‚â”‚W3â”‚ â”‚W4â”‚â”‚ â”‚â”‚W5â”‚ â”‚W6â”‚â”‚
   â”‚â””â”¬â”€â”˜ â””â”¬â”€â”˜â”‚ â”‚â””â”¬â”€â”˜ â””â”¬â”€â”˜â”‚ â”‚â””â”¬â”€â”˜ â””â”¬â”€â”˜â”‚
   â””â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”˜ â””â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”˜ â””â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”˜
     â”‚    â”‚      â”‚    â”‚      â”‚    â”‚
     â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
            â”‚
            â”‚ 4-8. Process in parallel
            â”‚      - Download CSV
            â”‚      - Parse data
            â”‚      - Create experiments
            â”‚      - Store metadata
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Kruize     â”‚
     â”‚ + ROS DB   â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚ 9. Async polling
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Poller     â”‚
     â”‚ Workers    â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚ 10. Store recommendations
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  ROS DB    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps: 10 (parallelized)
Latency: ~1-2 minutes
Parallelization: High
Throughput: 10x+
```

---

## Deployment Topology

### Current Deployment (8-10 Pods)

```yaml
Namespace: ros-ocp
â”œâ”€â”€ Stateful Services (5 pods)
â”‚   â”œâ”€â”€ db-ros (PostgreSQL)           [1 pod]
â”‚   â”œâ”€â”€ db-kruize (PostgreSQL)        [1 pod]
â”‚   â”œâ”€â”€ db-sources (PostgreSQL)       [1 pod]
â”‚   â”œâ”€â”€ redis (Cache)                 [1 pod]
â”‚   â””â”€â”€ minio (Object Storage)        [1 pod]
â”‚
â”œâ”€â”€ Application Services (6 pods)
â”‚   â”œâ”€â”€ ingress                       [1 pod]  â† JWT validation
â”‚   â”œâ”€â”€ rosocp-api                    [1 pod]  â† OAuth2 validation
â”‚   â”œâ”€â”€ rosocp-processor              [1 pod]
â”‚   â”œâ”€â”€ rosocp-recommendation-poller  [1 pod]
â”‚   â”œâ”€â”€ sources-api                   [1 pod]
â”‚   â””â”€â”€ kruize                        [1 pod]
â”‚
â”œâ”€â”€ Maintenance (1 pod)
â”‚   â””â”€â”€ rosocp-housekeeper            [1 pod]
â”‚
â””â”€â”€ External Dependencies
    â””â”€â”€ kafka (Strimzi namespace)     [3 pods]

Total: ~14 pods (including Kafka)
```

### Target Deployment (27+ Pods)

```yaml
Namespace: ros-ocp
â”œâ”€â”€ Stateful Services (6 pods)
â”‚   â”œâ”€â”€ db-ros-primary (PostgreSQL)   [1 pod]  â† Write operations
â”‚   â”œâ”€â”€ db-ros-replica (PostgreSQL)   [1 pod]  â† Read operations â˜…NEW
â”‚   â”œâ”€â”€ db-kruize (PostgreSQL)        [1 pod]
â”‚   â”œâ”€â”€ db-sources (PostgreSQL)       [1 pod]
â”‚   â”œâ”€â”€ redis (Cache + Broker)        [1 pod]  â† Also Celery broker
â”‚   â””â”€â”€ minio (Object Storage)        [1 pod]
â”‚
â”œâ”€â”€ API Layer (5 pods)
â”‚   â”œâ”€â”€ rosocp-api-reads              [3 pods] â˜…NEW - Horizontally scaled
â”‚   â””â”€â”€ rosocp-api-writes             [2 pods] â˜…NEW - Lower replica count
â”‚
â”œâ”€â”€ Background Processing (26 pods)
â”‚   â”œâ”€â”€ worker-priority               [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-priority-xl            [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-priority-penalty       [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-refresh                [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-refresh-xl             [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-refresh-penalty        [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-summary                [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-summary-xl             [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-summary-penalty        [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-download               [2 pods] â˜…NEW
â”‚   â”œâ”€â”€ worker-hcs                    [1 pod]  â˜…NEW
â”‚   â”œâ”€â”€ worker-subs-extraction        [0 pods] (disabled)
â”‚   â”œâ”€â”€ worker-subs-transmission      [0 pods] (disabled)
â”‚   â””â”€â”€ celery-beat                   [1 pod]  â˜…NEW - Scheduler
â”‚
â”œâ”€â”€ Supporting Services (3 pods)
â”‚   â”œâ”€â”€ ingress                       [1 pod]
â”‚   â”œâ”€â”€ sources-api                   [1 pod]
â”‚   â””â”€â”€ kruize                        [1 pod]
â”‚
â”œâ”€â”€ Maintenance (1 pod)
â”‚   â””â”€â”€ rosocp-housekeeper            [1 pod]
â”‚
â””â”€â”€ External Dependencies
    â””â”€â”€ kafka (Strimzi namespace)     [3 pods]

Total: ~44 pods (including Kafka)

Resource Increase:
  Pods:   +30 pods (+300%)
  CPU:    +3-4 cores
  Memory: +6-8 GB
  Value:  10x throughput, independent scaling
```

---

## Integration Vision

### Phase 1: Foundation (Weeks 1-2)
```
Current State â”€â”€â”
                â”‚
                â”œâ”€â”€> Enhanced Configuration
                â”œâ”€â”€> Secret Management
                â”œâ”€â”€> Resource Tuning
                â”‚
                â””â”€â”€> Enhanced Current Deployment
                     (No new pods, better configured)
```

### Phase 2: API Separation (Weeks 3-4)
```
Single API Pod â”€â”€â”
                 â”‚
                 â”œâ”€â”€> API-Reads (3 pods)
                 â”‚      â”‚
                 â”‚      â””â”€â”€> Read Replica DB
                 â”‚
                 â””â”€â”€> API-Writes (2 pods)
                        â”‚
                        â””â”€â”€> Primary DB

Pod Count: +4 pods (8 â†’ 12)
Value: 3-5x read performance
```

### Phase 3: Worker Architecture (Weeks 5-8)
```
Single Processor â”€â”€â”
                   â”‚
                   â”œâ”€â”€> Priority Workers (6 pods)
                   â”œâ”€â”€> Refresh Workers (6 pods)
                   â”œâ”€â”€> Summary Workers (6 pods)
                   â”œâ”€â”€> Specialized Workers (5 pods)
                   â””â”€â”€> Celery Beat (1 pod)

Pod Count: +24 pods (12 â†’ 36)
Value: 10x throughput, task prioritization
```

### Phase 4: Complete Integration
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Production-Ready, Scalable, High-Throughput Platform    â”‚
â”‚                                                            â”‚
â”‚  âœ… Separated read/write APIs                            â”‚
â”‚  âœ… Specialized worker pools                             â”‚
â”‚  âœ… Independent component scaling                        â”‚
â”‚  âœ… Task prioritization and routing                      â”‚
â”‚  âœ… Enhanced monitoring and observability                â”‚
â”‚  âœ… Comprehensive configuration                          â”‚
â”‚                                                            â”‚
â”‚  Performance: 10x throughput improvement                  â”‚
â”‚  Scalability: Independent scaling per component          â”‚
â”‚  Reliability: Better fault isolation                     â”‚
â”‚  Operations: Production-proven patterns                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Architectural Decisions

### 1. API Separation Strategy
**Decision**: Separate read and write APIs at the deployment level

**Alternatives Considered:**
- âŒ Single API with read/write routing logic (complex, error-prone)
- âŒ Service mesh-based routing (additional infrastructure)
- âœ… Separate deployments (clean, simple, proven)

**Rationale:**
- Clean separation of concerns
- Independent scaling based on traffic patterns
- Easier to optimize each type
- Production-proven in upstream Koku

### 2. Worker Pool Design
**Decision**: Start with 5 essential worker types, expand to 13

**Initial Workers (Phase 3A):**
1. Priority (urgent tasks)
2. Refresh (data refresh tasks)
3. Summary (report generation)
4. Download (data ingestion)
5. Default (fallback)

**Add Later (Phase 3B):**
6. Priority-XL (large priority tasks)
7. Refresh-XL (large refresh tasks)
8. Summary-XL (large summaries)
9. Specialized workers (HCS, penalty, subscriptions)

**Rationale:**
- Start simple, expand based on actual needs
- Avoid over-engineering initially
- Learn from production patterns
- Maintain flexibility

### 3. Message Broker Choice
**Decision**: Use Redis for Celery broker

**Alternatives Considered:**
- RabbitMQ (more features, higher resource usage)
- Kafka (overkill for task queuing)
- âœ… Redis (already deployed, dual purpose: cache + broker)

**Rationale:**
- Redis already in deployment
- Sufficient for task queuing needs
- Lower operational overhead
- Can upgrade to RabbitMQ if needed

### 4. Database Read Replica
**Decision**: Phase 2 priority, critical for scaling

**Benefits:**
- Offloads 60-70% of database queries from primary
- Enables read API scaling to 10+ pods
- Reduces write operation latency
- Production-proven pattern

**Requirements:**
- PostgreSQL replication setup
- Connection string routing
- Replication lag monitoring
- Failover procedures

---

## Performance Projections

### Current Performance (Baseline)
```
API Throughput:      ~100 req/s
Background Tasks:    ~30 tasks/min
Database CPU:        70-80% on primary
API Latency (p95):   800ms
Task Latency:        2-5 minutes
```

### After Phase 2 (API Separation)
```
API Throughput:      ~300 req/s          (+200%)
Background Tasks:    ~30 tasks/min        (unchanged)
Database CPU:        30-40% on primary    (-50%)
                     60-70% on replica    (new)
API Latency (p95):   300ms                (-60%)
Task Latency:        2-5 minutes          (unchanged)
```

### After Phase 3 (Full Integration)
```
API Throughput:      ~300 req/s          (+200% from baseline)
Background Tasks:    ~1000 tasks/min     (+3200% from baseline)
Database CPU:        30-40% on primary   (-50% from baseline)
                     60-70% on replica
API Latency (p95):   300ms               (-60% from baseline)
Task Latency:        15-60 seconds       (-75% from baseline)
Priority Tasks:      <10 seconds         (new capability)
```

---

## Summary

| Aspect | Current | Target | Improvement |
|--------|---------|--------|-------------|
| **Total Pods** | 8-10 | 36-44 | +300% |
| **API Pods** | 1 | 5 | +400% |
| **Worker Pods** | 1 | 24 | +2300% |
| **API Throughput** | 100 req/s | 300 req/s | +200% |
| **Task Throughput** | 30/min | 1000/min | +3200% |
| **Database Load** | 80% primary | 40% primary<br>70% replica | -50% primary |
| **API Latency (p95)** | 800ms | 300ms | -60% |
| **Task Latency** | 2-5 min | 15-60s | -75% |
| **Scaling Flexibility** | Limited | High | Infinite |
| **Operational Complexity** | Low | Medium-High | +100% |

---

**See Also:**
- [Complete Gap Analysis](koku-clowdapp-gap-analysis.md) - Detailed technical analysis
- [Integration Summary](koku-integration-summary.md) - Executive summary
- [Koku ClowdApp Source](https://github.com/insights-onprem/koku/blob/main/deploy/clowdapp.yaml) - Upstream reference

---

**Document Version**: 1.0
**Last Updated**: November 6, 2025
**Status**: Analysis Complete

