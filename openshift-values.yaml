# Testing/CI Values Overlay for Cost Management On-Premise
# =========================================================
# This file provides OVERRIDES for testing and CI environments only.
# It is layered on top of the base values.yaml during helm install.
#
# Purpose:
# - Smaller resource allocations suitable for testing environments
# - Reduced storage sizes (5Gi vs production sizes)
# - CI optimization hints to reduce Helm API lookups
#
# For production deployments, use larger values:
#   --set database.ros.storage.size=100Gi
#   --set resources.kruize.requests.memory=2Gi

global:
  # Cluster domain - auto-detected if empty, but providing it skips 4 API lookups
  # CI script will set this dynamically: $(oc get ingresses.config.openshift.io cluster -o jsonpath='{.spec.domain}')
  clusterDomain: ""  # Set by CI or leave empty for auto-detection

  # Cluster name - auto-detected if empty, but providing it skips 2 API lookups
  clusterName: ""  # Set by CI or leave empty for auto-detection

# Explicit storage class names to avoid API lookups (optional but recommended for CI)
# When provided, skips StorageClass list/get API calls (saves 2-4 lookups)
# storageClassNames:
#   database: "odf-storagecluster-ceph-rbd"
#   kafka: "odf-storagecluster-ceph-rbd"
#   storage: "odf-storagecluster-ceph-rbd"
#   valkey: "odf-storagecluster-ceph-rbd"

# Reduced resource requirements for testing environment
# Production recommendation: Increase memory for Kruize (2-4Gi)
resources:
  application:
    requests:
      memory: "512Mi"
      cpu: "200m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  kruize:
    requests:
      memory: "1Gi"
      cpu: "200m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

# Use smaller storage sizes for testing
# Production recommendation: 100Gi for ros/kruize, 50Gi for sources
database:
  ros:
    storage:
      size: "5Gi"

  kruize:
    storage:
      size: "5Gi"

  sources:
    storage:
      size: "5Gi"

# S3-Compatible Object Storage
# ----------------------------
# This chart requires S3-compatible storage. Options:
#
#   1. Manual (production): Set objectStorage.endpoint/port/useSSL/existingSecret
#      and pre-create your credentials secret. The install script will skip
#      all S3 auto-detection.
#
#   2. OBC auto-detection: Create an ObjectBucketClaim named "ros-data-ceph"
#      in the target namespace. The install script auto-detects it and
#      configures endpoints, credentials, and bucket names.
#
#   3. MinIO (dev/test): Set MINIO_ENDPOINT env var before running the install
#      script. See docs/development/ocp-dev-setup-minio.md.
#
#   4. Leave empty: The install script attempts NooBaa auto-detection as fallback.
#      WARNING: NooBaa's eventual consistency may cause data processing failures.
#
objectStorage:
  endpoint: ""  # Set manually, or auto-detected by install script
  port: 443
  useSSL: true
  existingSecret: ""  # Set to use a pre-existing credentials secret (skips secret creation)

# JWT Authentication configuration (avoids Keycloak auto-discovery lookups)
# Providing explicit Keycloak settings saves ~8 API lookups
# CI script will set this dynamically: $(oc get route -n keycloak keycloak -o jsonpath='{.spec.host}')
jwtAuth:
  keycloak:
    # url: ""  # Set by CI script, e.g., "https://keycloak.apps.example.com"
    installed: true  # Tells chart Keycloak exists, skips CR lookup
    # namespace: "keycloak"  # Optional: skip namespace discovery
    # serviceName: "keycloak"  # Optional: skip service discovery

# OpenShift Routes configuration
# Override: longer timeout (300s vs 30s default) for large file uploads
gatewayRoute:
  enabled: true
  annotations:
    haproxy.router.openshift.io/timeout: "300s"
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect