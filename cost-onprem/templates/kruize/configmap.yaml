apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cost-onprem.fullname" . }}-kruize-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "cost-onprem.labels" . | nindent 4 }}
data:
  cdappconfig.json: |
    {
      "database": {
        "hostname": "{{ include "cost-onprem.kruize.databaseHost" . }}",
        "name": "{{ .Values.database.kruize.name }}",
        "port": {{ .Values.database.server.port }},
        "sslMode": "{{ .Values.database.server.sslMode }}"
      },
      "_comment": "Credentials removed - applications must use environment variables (DATABASE_USER, DATABASE_PASSWORD) from secrets",
      "kafka": {
        "brokers": [
          {
            "authtype": "sasl",
            "hostname": "{{ include "cost-onprem.kafka.host" . }}",
            "port": {{ include "cost-onprem.kafka.port" . }},
            "sasl": {
              "password": "",
              "saslMechanism": "PLAIN",
              "securityProtocol": "SSL",
              "username": ""
            },
            "securityProtocol": "SSL",
            "cacert": "-----BEGIN CERTIFICATE-----\nMIIDvTCCAqWgAwIBAgIUctrqAnBFhUmpF7Yti5AJW7dCnAUwDQYJKoZIhvcNAQEL\nBQAwbTESMBAGA1UEAwwJY2ExLmxvY2FsMRQwEgYDVQQLDAtteS1vcmctdW5pdDEP\nMA0GA1UECgwGbXktb3JnMRAwDgYDVQQHDAdteS1jaXR5MREwDwYDVQQIDAhteS1z\ndGF0ZTELMAkGA1UEBhMCQVUwIBcNMjQwMTAyMDgzNjM4WhgPMjA1MTA1MTkwODM2\nMzhaMG0xEjAQBgNVBAMMCWNhMS5sb2NhbDEUMBIGA1UECwwLbXktb3JnLXVuaXQx\nDzANBgNVBAoMBm15LW9yZzEQMA4GA1UEBwwHbXktY2l0eTERMA8GA1UECAwIbXkt\nc3RhdGUxCzAJBgNVBAYTAkFVMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC\nAQEAs3pAov4jmDyxd+aPQR6KyzACBjHFOQZ/kGk5bZYX1BCTIkCOw802ydzbfdRg\nSCLM1fukn8MyVLM0Lv2JhJe+Ev68ZfbgCTgYiayksyZH1kyOmUAJhsk+mAse/kCW\nP4uxdnNPIWc9Fb+hthYblf7nXUh0h+9rUNItLNay7eiTJe8/pUWZevwJwFL1fgjo\nsNhZAbvBk0yr3j8IlXpa0je8NPFuhoCQtpwHtzeFK8ntGjs9bjV8OjL5nHCwOlWe\naVUr/twGPZLLyYCKGsSejs/gS64gLVOfd9huHf2fZ/loXa4yJT12MSAieGLJ3eNA\n2VXA526y+oof+ePIyOoode5cfwIDAQABo1MwUTAdBgNVHQ4EFgQUzgMMah64ZL1D\n/CKiBYfVeWJ3ttMwHwYDVR0jBBgwFoAUzgMMah64ZL1D/CKiBYfVeWJ3ttMwDwYD\nVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAiuTGQG1nU7Q+cjfVbEjS\nYykiY0Nb0E0EKCnKO3B96s7efw9wOgQ7m5U0Vtz4o67LTIWFYcD5iQIyv5xmWYux\nGSWH+BKIFs9uy5ZEPlLsX/YZEIIy+2nLjP5v5+DJdDZrJPIr8Yb5Mb6YybVjTkgQ\nXqbo0CbdDTRU6Gx5O1GptydzKCtmfJZw+Xh4SCQktzI8R9+iANjXKWEo3oeF/yMv\neMYAwOVauUbncdhV4oE7HewFABYdZfUmW4eWKw0MW6J7rq0/nUBdX3tQkJ2pGl5i\n5wKQJ5X00I9r60u6tOd5uRalnNu6wVywlrC4+YVpOyK7iXnC7MnCKCv/8acpxKW0\njw==\n-----END CERTIFICATE-----"
          }
        ],
        "topics": [
          {
            "name": "{{ .Values.ros.processor.uploadTopic }}",
            "requestedName": "{{ .Values.ros.processor.uploadTopic }}"
          },
          {
            "name": "{{ .Values.ros.recommendationPoller.recommendationTopic }}",
            "requestedName": "{{ .Values.ros.recommendationPoller.recommendationTopic }}"
          }
        ]
      },
      "logging": {
        "cloudwatch": {
          "accessKeyId": "",
          "logGroup": "",
          "region": "",
          "secretAccessKey": ""
        },
        "type": "null"
      },
      "metricsPath": "/metrics",
      "metricsPort": 9000,
      "privatePort": 10000,
      "publicPort": {{ .Values.kruize.port }},
      "webPort": {{ .Values.kruize.port }}
    }