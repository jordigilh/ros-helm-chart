apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cost-onprem.fullname" . }}-cdapp-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "cost-onprem.labels" . | nindent 4 }}
data:
  cdappconfig.json: |
    {
      "database": {
        "adminPassword": "{{ include "cost-onprem.database.ros.password" . }}",
        "adminUsername": "{{ include "cost-onprem.database.ros.user" . }}",
        "hostname": "{{ include "cost-onprem.database.host" (list . "ros") }}",
        "name": "{{ .Values.database.ros.name }}",
        "password": "{{ include "cost-onprem.database.ros.password" . }}",
        "port": {{ .Values.database.server.port }},
        "username": "{{ include "cost-onprem.database.ros.user" . }}",
        "sslMode": "{{ .Values.database.server.sslMode }}"
      },
      "kafka": {
        "brokers": [
          {
            "hostname": "{{ include "cost-onprem.kafka.host" . }}",
            "port": {{ include "cost-onprem.kafka.port" . }}
          }
        ],
        "topics": [
          {
            "name": "{{ .Values.ros.processor.uploadTopic }}",
            "requestedName": "{{ .Values.ros.processor.uploadTopic }}"
          },
          {
            "name": "{{ .Values.ros.recommendationPoller.recommendationTopic }}",
            "requestedName": "{{ .Values.ros.recommendationPoller.recommendationTopic }}"
          },
          {
            "name": "{{ .Values.sourcesApi.platformSourcesEventStreamTopic }}",
            "requestedName": "{{ .Values.sourcesApi.platformSourcesEventStreamTopic }}"
          }
        ]
      },
      "logging": {
        "type": "null"
      },
      "metricsPath": "/metrics",
      "metricsPort": 9000,
      "privatePort": 10000,
      "publicPort": 8000,
      "webPort": 8000
    }