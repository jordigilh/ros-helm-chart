apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "cost-onprem.fullname" . }}-cdapp-config
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "cost-onprem.labels" . | nindent 4 }}
data:
  cdappconfig.json: |
    {
      "database": {
        "hostname": "{{ include "cost-onprem.database.host" . }}",
        "name": "{{ .Values.database.ros.name }}",
        "port": {{ .Values.database.server.port }},
        "sslMode": "{{ .Values.database.server.sslMode }}"
      },
      "_comment": "Credentials removed - applications must use environment variables (DB_USER, DB_PASSWORD) from secrets",
      "kafka": {
        "brokers": [
          {
            "hostname": "{{ include "cost-onprem.kafka.host" . }}",
            "port": {{ include "cost-onprem.kafka.port" . }}
          }
        ],
        "topics": [
          {
            "name": "{{ .Values.ros.processor.uploadTopic }}",
            "requestedName": "{{ .Values.ros.processor.uploadTopic }}"
          },
          {
            "name": "{{ .Values.ros.recommendationPoller.recommendationTopic }}",
            "requestedName": "{{ .Values.ros.recommendationPoller.recommendationTopic }}"
          },
          {
            "name": "{{ .Values.sourcesApi.platformSourcesEventStreamTopic }}",
            "requestedName": "{{ .Values.sourcesApi.platformSourcesEventStreamTopic }}"
          }
        ]
      },
      "logging": {
        "type": "null"
      },
      "metricsPath": "/metrics",
      "metricsPort": 9000,
      "privatePort": 10000,
      "publicPort": 8000,
      "webPort": 8000
    }